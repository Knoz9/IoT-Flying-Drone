<!DOCTYPE html>
<html>
<head>
    <title>Pico Joystick Controller</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden; /* Disable scrolling */
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
        }
        body, html {
        height: 100vh; /* Use viewport height */
        max-height: 100vh; /* Prevent extending beyond the viewport height */
        }
        body, html {
        width: 100vw; /* Viewport width to ensure full width is covered */
        overflow-x: hidden; /* Specifically disable horizontal scrolling */
        }


        #joystick {
            width: 100px;
            height: 100px;
            background-color: #ddd;
            border-radius: 50%;
            position: absolute; /* Use absolute positioning within the flex container */
        }
        #handle {
            width: 50px;
            height: 50px;
            background-color: #bbb;
            border-radius: 50%;
            position: absolute;
            top: 50px; left: 25px; /* Centered within joystick */
            touch-action: none; /* Prevent the browser from handling touch actions */
        }
    </style>
</head>
<body>
    <div id="joystick">
        <div id="handle"></div>
    </div>
   <script>
    const joystick = document.getElementById('joystick');
    const handle = document.getElementById('handle');
    let active = false;
    let currentYPercentage = 0; // Assume starting at the middle (50%)
    let intervalId = null;

    function moveHandle(e) {
        e.preventDefault(); // Prevent default behavior for all events
        let event = e.type.includes('touch') ? e.touches[0] : e;
        let rect = joystick.getBoundingClientRect();
        let clientY = event.clientY - rect.top;

        // Ensure the handle stays within the joystick's vertical bounds
        let handleTopMin = 0;
        let handleTopMax = rect.height - handle.offsetHeight;
        let handleY = Math.max(Math.min(clientY - (handle.offsetHeight / 2), handleTopMax), handleTopMin);

        // Calculate the percentage position of the handle
        currentYPercentage = 100 - ((handleY / handleTopMax) * 100);
        handle.style.top = `${handleY}px`;
    }

    function updatePosition() {
        // Send the vertical position as a percentage, rounded to nearest integer
        sendPosition(Math.round(currentYPercentage));
    }

    function sendPosition(y) {
        console.log(`Vertical Position: ${y}%`); // For debugging
        fetch(`/position?y=${y}`).catch(console.error);
    }

    // Initialize periodic updates
    function startPeriodicUpdates() {
        if (!intervalId) {
            intervalId = setInterval(updatePosition, 300); // Update position every 1 second
        }
    }

    function stopPeriodicUpdates() {
        if (intervalId) {
            clearInterval(intervalId);
            intervalId = null;
        }
    }

    // Event listeners to handle drag/move
    joystick.addEventListener('mousedown', (e) => { active = true; moveHandle(e); startPeriodicUpdates(); });
    joystick.addEventListener('touchstart', (e) => { active = true; moveHandle(e); startPeriodicUpdates(); }, {passive: false});

    document.addEventListener('mousemove', (e) => { if (active) moveHandle(e); });
    document.addEventListener('touchmove', (e) => { if (active) moveHandle(e); }, {passive: false});

    // Event listeners to stop moving the handle and updates
    document.addEventListener('mouseup', () => { active = false; });
    document.addEventListener('touchend', () => { active = false; });

    // Start periodic updates by default in case the joystick is not moved after page load
    startPeriodicUpdates();
</script>


</body>
</html>